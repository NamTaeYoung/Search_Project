<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.boot.dao.StockInfoDAO">
	<!-- 종목 자동완성 검색 -->
    <select id="searchStocks" parameterType="string" resultType="com.boot.dto.StockInfoDTO">
        SELECT STOCK_CODE, STOCK_NAME, MARKET_TYPE, INDUSTRY, PRICE,
      		   PRICE_CHANGE, CHANGE_RATE, MARKET_CAP, UPDATED_AT
        FROM STOCK_INFO
        WHERE STOCK_NAME LIKE '%' || #{keyword} || '%'
        ORDER BY STOCK_NAME
    </select>

    <!-- 상세 정보 -->
    <select id="getStockDetail" parameterType="string" resultType="com.boot.dto.StockInfoDTO">
        SELECT STOCK_CODE, STOCK_NAME, MARKET_TYPE, INDUSTRY, PRICE,
       		   PRICE_CHANGE, CHANGE_RATE, MARKET_CAP, UPDATED_AT
        FROM STOCK_INFO
        WHERE STOCK_CODE = #{stockCode}
    </select>

	<select id="selectTop100MarketCapPaged" resultType="com.boot.dto.StockInfoDTO">
	    SELECT *
	    FROM (
	        SELECT inner_q.*, ROWNUM AS rn
	        FROM (
	            SELECT
	                STOCK_CODE,
	                STOCK_NAME,
	                MARKET_TYPE,
	                INDUSTRY,
	                PRICE,
	                PRICE_CHANGE,
	                CHANGE_RATE,
	                MARKET_CAP,
	                UPDATED_AT
	            FROM STOCK_INFO
	            ORDER BY TO_NUMBER(REPLACE(MARKET_CAP, ',', '')) DESC
	        ) inner_q
	        WHERE ROWNUM &lt;= #{end}
	    )
	    WHERE rn &gt;= #{start}
	</select>






    
    <select id="selectTopRisingStocks" resultType="com.boot.dto.StockInfoDTO">
    SELECT * FROM (
        SELECT
            STOCK_CODE, 
            STOCK_NAME, 
            CHANGE_RATE
        FROM
            STOCK_INFO
        ORDER BY
            CHANGE_RATE DESC
    )
    WHERE ROWNUM &lt;= 3  </select>
    
    <select id="selectTopFallingStocks" resultType="com.boot.dto.StockInfoDTO">
    SELECT * FROM (
        SELECT
            STOCK_CODE, 
            STOCK_NAME, 
            CHANGE_RATE
        FROM
            STOCK_INFO
        ORDER BY
            CHANGE_RATE ASC  )
    WHERE ROWNUM &lt;= 3
</select>
</mapper>
